# Backend Architecture Patterns - Patterns kiáº¿n trÃºc backend

## ğŸ“Š Tá»•ng quan

TÃ i liá»‡u nÃ y mÃ´ táº£ cÃ¡c patterns kiáº¿n trÃºc backend Ä‘Æ°á»£c sá»­ dá»¥ng trong há»‡ thá»‘ng AI Camera Counting, bao gá»“m microservices patterns, data patterns, vÃ  integration patterns.

## ğŸ¯ Má»¥c tiÃªu

### Má»¥c tiÃªu chÃ­nh
- **Scalability**: Kháº£ nÄƒng má»Ÿ rá»™ng theo chiá»u ngang vÃ  dá»c
- **Maintainability**: Code dá»… báº£o trÃ¬ vÃ  má»Ÿ rá»™ng
- **Performance**: Hiá»‡u suáº¥t cao vá»›i táº£i lá»›n
- **Reliability**: Äá»™ tin cáº­y vÃ  fault tolerance
- **Security**: Báº£o máº­t end-to-end
- **Testability**: Dá»… dÃ ng test vÃ  validate

### YÃªu cáº§u ká»¹ thuáº­t
- **Microservices Architecture**: TÃ¡ch biá»‡t cÃ¡c service
- **Event-Driven Architecture**: Xá»­ lÃ½ báº¥t Ä‘á»“ng bá»™
- **CQRS Pattern**: TÃ¡ch biá»‡t read/write operations
- **Repository Pattern**: Abstraction cho data access
- **Dependency Injection**: Loose coupling
- **Circuit Breaker**: Fault tolerance

## ğŸ—ï¸ Microservices Architecture Patterns

### 1. Service Decomposition Pattern

#### Backend Architecture Overview Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              BACKEND ARCHITECTURE OVERVIEW                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚   API Gateway   â”‚  â”‚   Load Balancer â”‚  â”‚   Service Mesh  â”‚                  â”‚
â”‚  â”‚   (NGINX)       â”‚  â”‚   (HAProxy)     â”‚  â”‚   (Istio)       â”‚                  â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚                  â”‚
â”‚  â”‚ â€¢ Route Requestsâ”‚  â”‚ â€¢ Traffic Dist  â”‚  â”‚ â€¢ Service Disc  â”‚                  â”‚
â”‚  â”‚ â€¢ Auth/Authorizeâ”‚  â”‚ â€¢ Health Check  â”‚  â”‚ â€¢ Circuit Breakerâ”‚                  â”‚
â”‚  â”‚ â€¢ Rate Limiting â”‚  â”‚ â€¢ Failover      â”‚  â”‚ â€¢ Retry Logic   â”‚                  â”‚
â”‚  â”‚ â€¢ SSL/TLS       â”‚  â”‚ â€¢ Load Balancingâ”‚  â”‚ â€¢ Observability â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              MICROSERVICES LAYER                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚   Auth Service  â”‚  â”‚  Camera Service â”‚  â”‚ Analytics Serviceâ”‚                  â”‚
â”‚  â”‚   (Node.js)     â”‚  â”‚   (Python)      â”‚  â”‚   (Python)      â”‚                  â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚                  â”‚
â”‚  â”‚ â€¢ User Auth     â”‚  â”‚ â€¢ Camera Mgmt   â”‚  â”‚ â€¢ Data Analyticsâ”‚                  â”‚
â”‚  â”‚ â€¢ JWT Tokens    â”‚  â”‚ â€¢ AI Processing â”‚  â”‚ â€¢ Report Gen    â”‚                  â”‚
â”‚  â”‚ â€¢ User Mgmt     â”‚  â”‚ â€¢ Worker Pool   â”‚  â”‚ â€¢ Metrics       â”‚                  â”‚
â”‚  â”‚ â€¢ Permissions   â”‚  â”‚ â€¢ Stream Mgmt   â”‚  â”‚ â€¢ Dashboards    â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ Notification    â”‚  â”‚   Worker Pool   â”‚  â”‚   WebSocket     â”‚                  â”‚
â”‚  â”‚   Service       â”‚  â”‚   Service       â”‚  â”‚   Service       â”‚                  â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚                  â”‚
â”‚  â”‚ â€¢ Email/SMS     â”‚  â”‚ â€¢ Task Queue    â”‚  â”‚ â€¢ Real-time     â”‚                  â”‚
â”‚  â”‚ â€¢ Push Notif    â”‚  â”‚ â€¢ Worker Mgmt   â”‚  â”‚ â€¢ Broadcasting  â”‚                  â”‚
â”‚  â”‚ â€¢ Alert Mgmt    â”‚  â”‚ â€¢ Load Balance  â”‚  â”‚ â€¢ Connection    â”‚                  â”‚
â”‚  â”‚ â€¢ Templates     â”‚  â”‚ â€¢ Scaling       â”‚  â”‚ â€¢ Event Routing â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              DATA LAYER                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚   PostgreSQL    â”‚  â”‚   Redis Cache   â”‚  â”‚   Message Queue â”‚                  â”‚
â”‚  â”‚   (Primary DB)  â”‚  â”‚   (L2 Cache)    â”‚  â”‚   (RabbitMQ)    â”‚                  â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚                  â”‚
â”‚  â”‚ â€¢ User Data     â”‚  â”‚ â€¢ Session Data  â”‚  â”‚ â€¢ Event Queue   â”‚                  â”‚
â”‚  â”‚ â€¢ Camera Data   â”‚  â”‚ â€¢ Real-time     â”‚  â”‚ â€¢ Task Queue    â”‚                  â”‚
â”‚  â”‚ â€¢ Analytics     â”‚  â”‚ â€¢ Analytics     â”‚  â”‚ â€¢ Dead Letter   â”‚                  â”‚
â”‚  â”‚ â€¢ Audit Logs    â”‚  â”‚ â€¢ Rate Limiting â”‚  â”‚ â€¢ Retry Logic   â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Microservices Decomposition Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              MICROSERVICES DECOMPOSITION                        â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                              BOUNDED CONTEXTS                               â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚ â”‚
â”‚  â”‚  â”‚   User Mgmt     â”‚  â”‚   Camera Mgmt   â”‚  â”‚   Analytics     â”‚              â”‚ â”‚
â”‚  â”‚  â”‚   Context       â”‚  â”‚   Context       â”‚  â”‚   Context       â”‚              â”‚ â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚              â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Authenticationâ”‚  â”‚ â€¢ Camera CRUD   â”‚  â”‚ â€¢ Data Analysis â”‚              â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Authorization â”‚  â”‚ â€¢ Stream Mgmt   â”‚  â”‚ â€¢ Report Gen    â”‚              â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ User Profile  â”‚  â”‚ â€¢ AI Processing â”‚  â”‚ â€¢ Metrics       â”‚              â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Role Mgmt     â”‚  â”‚ â€¢ Worker Pool   â”‚  â”‚ â€¢ Dashboards    â”‚              â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚ â”‚
â”‚  â”‚  â”‚   Notification  â”‚  â”‚   Monitoring    â”‚  â”‚   Integration   â”‚              â”‚ â”‚
â”‚  â”‚  â”‚   Context       â”‚  â”‚   Context       â”‚  â”‚   Context       â”‚              â”‚ â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚              â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Email/SMS     â”‚  â”‚ â€¢ Health Check  â”‚  â”‚ â€¢ External APIs â”‚              â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Push Notif    â”‚  â”‚ â€¢ Metrics       â”‚  â”‚ â€¢ Webhooks      â”‚              â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Alert Mgmt    â”‚  â”‚ â€¢ Logging       â”‚  â”‚ â€¢ Data Sync     â”‚              â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Templates     â”‚  â”‚ â€¢ Alerting      â”‚  â”‚ â€¢ ETL Process   â”‚              â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                              SERVICE BOUNDARIES                             â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚ â”‚
â”‚  â”‚  â”‚   Auth Service  â”‚  â”‚  Camera Service â”‚  â”‚ Analytics Serviceâ”‚              â”‚ â”‚
â”‚  â”‚  â”‚   (Port: 3001)  â”‚  â”‚   (Port: 8000)  â”‚  â”‚   (Port: 8001)  â”‚              â”‚ â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚              â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ /auth/*       â”‚  â”‚ â€¢ /cameras/*    â”‚  â”‚ â€¢ /analytics/*  â”‚              â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ /users/*      â”‚  â”‚ â€¢ /workers/*    â”‚  â”‚ â€¢ /reports/*    â”‚              â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ /roles/*      â”‚  â”‚ â€¢ /streams/*    â”‚  â”‚ â€¢ /metrics/*    â”‚              â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ /permissions/*â”‚  â”‚ â€¢ /ai-models/*  â”‚  â”‚ â€¢ /dashboards/* â”‚              â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚ â”‚
â”‚  â”‚  â”‚ Notification    â”‚  â”‚   Worker Pool   â”‚  â”‚   WebSocket     â”‚              â”‚ â”‚
â”‚  â”‚  â”‚   Service       â”‚  â”‚   Service       â”‚  â”‚   Service       â”‚              â”‚ â”‚
â”‚  â”‚  â”‚   (Port: 8002)  â”‚  â”‚   (Port: 8003)  â”‚  â”‚   (Port: 8004)  â”‚              â”‚ â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚              â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ /notificationsâ”‚  â”‚ â€¢ /workers/*    â”‚  â”‚ â€¢ /ws/*         â”‚              â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ /templates/*  â”‚  â”‚ â€¢ /tasks/*      â”‚  â”‚ â€¢ /events/*     â”‚              â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ /alerts/*     â”‚  â”‚ â€¢ /queue/*      â”‚  â”‚ â€¢ /broadcast/*  â”‚              â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ /channels/*   â”‚  â”‚ â€¢ /scaling/*    â”‚  â”‚ â€¢ /connections/*â”‚              â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Service Communication Patterns Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              SERVICE COMMUNICATION PATTERNS                     â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                              SYNCHRONOUS COMMUNICATION                      â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚   Frontend  â”‚    â”‚   API       â”‚    â”‚   Camera    â”‚    â”‚   Auth      â”‚  â”‚ â”‚
â”‚  â”‚  â”‚   (React)   â”‚    â”‚   Gateway   â”‚    â”‚   Service   â”‚    â”‚   Service   â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚         â”‚                   â”‚                   â”‚                   â”‚      â”‚ â”‚
â”‚  â”‚         â”‚ 1. HTTP Request   â”‚                   â”‚                   â”‚      â”‚ â”‚
â”‚  â”‚         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                   â”‚                   â”‚      â”‚ â”‚
â”‚  â”‚         â”‚                   â”‚ 2. Route Request â”‚                   â”‚      â”‚ â”‚
â”‚  â”‚         â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                   â”‚      â”‚ â”‚
â”‚  â”‚         â”‚                   â”‚                   â”‚ 3. Auth Check    â”‚      â”‚ â”‚
â”‚  â”‚         â”‚                   â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚      â”‚ â”‚
â”‚  â”‚         â”‚                   â”‚                   â”‚                   â”‚      â”‚ â”‚
â”‚  â”‚         â”‚                   â”‚                   â”‚ 4. Auth Response â”‚      â”‚ â”‚
â”‚  â”‚         â”‚                   â”‚                   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚      â”‚ â”‚
â”‚  â”‚         â”‚                   â”‚                   â”‚                   â”‚      â”‚ â”‚
â”‚  â”‚         â”‚                   â”‚ 5. Process Requestâ”‚                   â”‚      â”‚ â”‚
â”‚  â”‚         â”‚                   â”‚                   â”‚                   â”‚      â”‚ â”‚
â”‚  â”‚         â”‚ 6. HTTP Response  â”‚                   â”‚                   â”‚      â”‚ â”‚
â”‚  â”‚         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚                   â”‚      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                              ASYNCHRONOUS COMMUNICATION                     â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚   Camera    â”‚    â”‚   Message   â”‚    â”‚   Worker    â”‚    â”‚ Analytics   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚   Service   â”‚    â”‚   Queue     â”‚    â”‚   Pool      â”‚    â”‚ Service     â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚         â”‚                   â”‚                   â”‚                   â”‚      â”‚ â”‚
â”‚  â”‚         â”‚ 1. Publish Event  â”‚                   â”‚                   â”‚      â”‚ â”‚
â”‚  â”‚         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                   â”‚                   â”‚      â”‚ â”‚
â”‚  â”‚         â”‚                   â”‚                   â”‚                   â”‚      â”‚ â”‚
â”‚  â”‚         â”‚                   â”‚ 2. Consume Event  â”‚                   â”‚      â”‚ â”‚
â”‚  â”‚         â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                   â”‚      â”‚ â”‚
â”‚  â”‚         â”‚                   â”‚                   â”‚                   â”‚      â”‚ â”‚
â”‚  â”‚         â”‚                   â”‚                   â”‚ 3. Process Task   â”‚      â”‚ â”‚
â”‚  â”‚         â”‚                   â”‚                   â”‚                   â”‚      â”‚ â”‚
â”‚  â”‚         â”‚                   â”‚                   â”‚ 4. Publish Result â”‚      â”‚ â”‚
â”‚  â”‚         â”‚                   â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚      â”‚ â”‚
â”‚  â”‚         â”‚                   â”‚                   â”‚                   â”‚      â”‚ â”‚
â”‚  â”‚         â”‚                   â”‚ 5. Consume Result â”‚                   â”‚      â”‚ â”‚
â”‚  â”‚         â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚      â”‚ â”‚
â”‚  â”‚         â”‚                   â”‚                   â”‚                   â”‚      â”‚ â”‚
â”‚  â”‚         â”‚                   â”‚                   â”‚ 6. Update Analyticsâ”‚     â”‚ â”‚
â”‚  â”‚         â”‚                   â”‚                   â”‚                   â”‚      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Data Architecture Patterns Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              DATA ARCHITECTURE PATTERNS                         â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                              DATABASE PER SERVICE                           â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚ â”‚
â”‚  â”‚  â”‚   Auth DB       â”‚  â”‚   Camera DB     â”‚  â”‚ Analytics DB    â”‚              â”‚ â”‚
â”‚  â”‚  â”‚   (PostgreSQL)  â”‚  â”‚   (PostgreSQL)  â”‚  â”‚   (TimescaleDB) â”‚              â”‚ â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚              â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ users         â”‚  â”‚ â€¢ cameras       â”‚  â”‚ â€¢ hourly_analytics            â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ user_sessions â”‚  â”‚ â€¢ counting_resultsâ”‚ â”‚ â€¢ daily_analytics             â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ permissions   â”‚  â”‚ â€¢ camera_events â”‚  â”‚ â€¢ monthly_analytics           â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ roles         â”‚  â”‚ â€¢ ai_models     â”‚  â”‚ â€¢ performance_metrics         â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ audit_logs    â”‚  â”‚ â€¢ worker_assignmentsâ”‚ â”‚ â€¢ trend_analysis            â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                              CACHING STRATEGY                               â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚ â”‚
â”‚  â”‚  â”‚   L1 Cache      â”‚  â”‚   L2 Cache      â”‚  â”‚   L3 Cache      â”‚              â”‚ â”‚
â”‚  â”‚  â”‚   (In-Memory)   â”‚  â”‚   (Redis)       â”‚  â”‚   (CDN)         â”‚              â”‚ â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚              â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Session Data  â”‚  â”‚ â€¢ User Data     â”‚  â”‚ â€¢ Static Assets â”‚              â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Temp Results  â”‚  â”‚ â€¢ Camera Data   â”‚  â”‚ â€¢ Images        â”‚              â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Query Cache   â”‚  â”‚ â€¢ Analytics     â”‚  â”‚ â€¢ Videos        â”‚              â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Rate Limiting â”‚  â”‚ â€¢ Real-time     â”‚  â”‚ â€¢ Documents     â”‚              â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                              DATA CONSISTENCY PATTERNS                      â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚ â”‚
â”‚  â”‚  â”‚   Strong        â”‚  â”‚   Eventual      â”‚  â”‚   Causal        â”‚              â”‚ â”‚
â”‚  â”‚  â”‚   Consistency   â”‚  â”‚   Consistency   â”‚  â”‚   Consistency   â”‚              â”‚ â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚              â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ User Auth     â”‚  â”‚ â€¢ Analytics     â”‚  â”‚ â€¢ Notifications â”‚              â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Permissions   â”‚  â”‚ â€¢ Reports       â”‚  â”‚ â€¢ Alerts        â”‚              â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Critical Data â”‚  â”‚ â€¢ Metrics       â”‚  â”‚ â€¢ Events        â”‚              â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Transactions  â”‚  â”‚ â€¢ Aggregations  â”‚  â”‚ â€¢ Messages      â”‚              â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### API Gateway Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              API GATEWAY ARCHITECTURE                           â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                              GATEWAY LAYERS                                 â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚ â”‚
â”‚  â”‚  â”‚   Security      â”‚  â”‚   Routing       â”‚  â”‚   Monitoring    â”‚              â”‚ â”‚
â”‚  â”‚  â”‚   Layer         â”‚  â”‚   Layer         â”‚  â”‚   Layer         â”‚              â”‚ â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚              â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Authenticationâ”‚  â”‚ â€¢ Load Balancingâ”‚  â”‚ â€¢ Metrics       â”‚              â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Authorization â”‚  â”‚ â€¢ Service Disc  â”‚  â”‚ â€¢ Logging       â”‚              â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Rate Limiting â”‚  â”‚ â€¢ Circuit Breakerâ”‚ â”‚ â€¢ Alerting      â”‚              â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ SSL/TLS       â”‚  â”‚ â€¢ Retry Logic   â”‚  â”‚ â€¢ Tracing       â”‚              â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ CORS          â”‚  â”‚ â€¢ Timeout Mgmt  â”‚  â”‚ â€¢ Health Check  â”‚              â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Input Valid   â”‚  â”‚ â€¢ Version Mgmt  â”‚  â”‚ â€¢ Performance   â”‚              â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                              ROUTING RULES                                  â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚ â”‚
â”‚  â”‚  â”‚   Auth Routes   â”‚  â”‚   Camera Routes â”‚  â”‚ Analytics Routesâ”‚              â”‚ â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚              â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ /api/v1/auth/*â”‚  â”‚ â€¢ /api/v1/cameras/*â”‚ â€¢ /api/v1/analytics/*        â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ /api/v1/users/*â”‚ â”‚ â€¢ /api/v1/workers/*â”‚ â€¢ /api/v1/reports/*          â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ /api/v1/roles/*â”‚ â”‚ â€¢ /api/v1/streams/*â”‚ â€¢ /api/v1/metrics/*          â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ /api/v1/permissions/*â”‚ â€¢ /api/v1/ai-models/*â”‚ â€¢ /api/v1/dashboards/* â”‚ â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚              â”‚ â”‚
â”‚  â”‚  â”‚ Target: Auth    â”‚  â”‚ Target: Camera  â”‚  â”‚ Target: Analyticsâ”‚            â”‚ â”‚
â”‚  â”‚  â”‚ Service         â”‚  â”‚ Service         â”‚  â”‚ Service         â”‚              â”‚ â”‚
â”‚  â”‚  â”‚ Port: 3001      â”‚  â”‚ Port: 8000      â”‚  â”‚ Port: 8001      â”‚              â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚ â”‚
â”‚  â”‚  â”‚ Notification    â”‚  â”‚   Worker Pool   â”‚  â”‚   WebSocket     â”‚              â”‚ â”‚
â”‚  â”‚  â”‚   Routes        â”‚  â”‚   Routes        â”‚  â”‚   Routes        â”‚              â”‚ â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚              â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ /api/v1/notifications/*â”‚ â€¢ /api/v1/workers/*â”‚ â€¢ /ws/*                 â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ /api/v1/templates/*â”‚ â€¢ /api/v1/tasks/*â”‚ â€¢ /api/v1/events/*           â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ /api/v1/alerts/*â”‚ â€¢ /api/v1/queue/*â”‚ â€¢ /api/v1/broadcast/*          â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ /api/v1/channels/*â”‚ â€¢ /api/v1/scaling/*â”‚ â€¢ /api/v1/connections/*     â”‚ â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚              â”‚ â”‚
â”‚  â”‚  â”‚ Target: Notificationâ”‚ Target: Worker â”‚  â”‚ Target: WebSocketâ”‚            â”‚ â”‚
â”‚  â”‚  â”‚ Service         â”‚  â”‚ Pool Service    â”‚  â”‚ Service         â”‚              â”‚ â”‚
â”‚  â”‚  â”‚ Port: 8002      â”‚  â”‚ Port: 8003      â”‚  â”‚ Port: 8004      â”‚              â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Backend Security Patterns Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              BACKEND SECURITY PATTERNS                          â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                              SECURITY LAYERS                                â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚ â”‚
â”‚  â”‚  â”‚   Network       â”‚  â”‚   Application   â”‚  â”‚   Data          â”‚              â”‚ â”‚
â”‚  â”‚  â”‚   Security      â”‚  â”‚   Security      â”‚  â”‚   Security      â”‚              â”‚ â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚              â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Firewall      â”‚  â”‚ â€¢ Authenticationâ”‚  â”‚ â€¢ Encryption    â”‚              â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ DDoS Protect  â”‚  â”‚ â€¢ Authorization â”‚  â”‚ â€¢ Access Controlâ”‚              â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ VPN           â”‚  â”‚ â€¢ Input Valid   â”‚  â”‚ â€¢ Audit Logging â”‚              â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ IDS/IPS       â”‚  â”‚ â€¢ Session Mgmt  â”‚  â”‚ â€¢ Backup        â”‚              â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Load Balancer â”‚  â”‚ â€¢ Rate Limiting â”‚  â”‚ â€¢ Compliance    â”‚              â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                              AUTHENTICATION FLOW                            â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚   Client    â”‚    â”‚   API       â”‚    â”‚   Auth      â”‚    â”‚   Database  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚   (Frontend)â”‚    â”‚   Gateway   â”‚    â”‚   Service   â”‚    â”‚             â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚         â”‚                   â”‚                   â”‚                   â”‚      â”‚ â”‚
â”‚  â”‚         â”‚ 1. Login Request  â”‚                   â”‚                   â”‚      â”‚ â”‚
â”‚  â”‚         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                   â”‚                   â”‚      â”‚ â”‚
â”‚  â”‚         â”‚                   â”‚ 2. Route to Auth  â”‚                   â”‚      â”‚ â”‚
â”‚  â”‚         â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                   â”‚      â”‚ â”‚
â”‚  â”‚         â”‚                   â”‚                   â”‚ 3. Validate User  â”‚      â”‚ â”‚
â”‚  â”‚         â”‚                   â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚      â”‚ â”‚
â”‚  â”‚         â”‚                   â”‚                   â”‚                   â”‚      â”‚ â”‚
â”‚  â”‚         â”‚                   â”‚                   â”‚ 4. User Data      â”‚      â”‚ â”‚
â”‚  â”‚         â”‚                   â”‚                   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚      â”‚ â”‚
â”‚  â”‚         â”‚                   â”‚                   â”‚                   â”‚      â”‚ â”‚
â”‚  â”‚         â”‚                   â”‚ 5. Generate JWT   â”‚                   â”‚      â”‚ â”‚
â”‚  â”‚         â”‚                   â”‚                   â”‚                   â”‚      â”‚ â”‚
â”‚  â”‚         â”‚ 6. JWT Response   â”‚                   â”‚                   â”‚      â”‚ â”‚
â”‚  â”‚         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚                   â”‚      â”‚ â”‚
â”‚  â”‚         â”‚                   â”‚                   â”‚                   â”‚      â”‚ â”‚
â”‚  â”‚         â”‚ 7. Store Token    â”‚                   â”‚                   â”‚      â”‚ â”‚
â”‚  â”‚         â”‚ (localStorage)    â”‚                   â”‚                   â”‚      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                              AUTHORIZATION MATRIX                           â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚ â”‚
â”‚  â”‚  â”‚   Roles         â”‚  â”‚   Permissions   â”‚  â”‚   Resources     â”‚              â”‚ â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚              â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Super Admin   â”‚  â”‚ â€¢ camera:read   â”‚  â”‚ â€¢ /cameras/*    â”‚              â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Admin         â”‚  â”‚ â€¢ camera:write  â”‚  â”‚ â€¢ /users/*      â”‚              â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Operator      â”‚  â”‚ â€¢ camera:delete â”‚  â”‚ â€¢ /analytics/*  â”‚              â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Viewer        â”‚  â”‚ â€¢ user:read     â”‚  â”‚ â€¢ /reports/*    â”‚              â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Guest         â”‚  â”‚ â€¢ user:write    â”‚  â”‚ â€¢ /settings/*   â”‚              â”‚ â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚ â€¢ analytics:readâ”‚  â”‚ â€¢ /logs/*       â”‚              â”‚ â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚ â€¢ analytics:writeâ”‚ â”‚ â€¢ /admin/*      â”‚              â”‚ â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚ â€¢ system:admin  â”‚  â”‚ â€¢ /api/*        â”‚              â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Service Boundaries
```yaml
# Service Decomposition
services:
  auth_service:
    responsibility: "Authentication & Authorization"
    bounded_context: "User Management"
    data_ownership: "User data, sessions, permissions"
    api_endpoints:
      - "/auth/login"
      - "/auth/register"
      - "/auth/refresh"
      - "/auth/logout"
  
  camera_service:
    responsibility: "Camera Management & Processing"
    bounded_context: "Camera Operations"
    data_ownership: "Camera data, streams, configurations"
    api_endpoints:
      - "/cameras"
      - "/cameras/{id}/stream"
      - "/cameras/{id}/config"
      - "/cameras/{id}/status"
  
  analytics_service:
    responsibility: "Analytics & Reporting"
    bounded_context: "Data Analytics"
    data_ownership: "Analytics data, reports, metrics"
    api_endpoints:
      - "/analytics/reports"
      - "/analytics/metrics"
      - "/analytics/export"
      - "/analytics/dashboard"
  
  notification_service:
    responsibility: "Notifications & Alerts"
    bounded_context: "Communication"
    data_ownership: "Notification templates, delivery logs"
    api_endpoints:
      - "/notifications/send"
      - "/notifications/templates"
      - "/notifications/history"
```

#### Service Communication
```yaml
# Service Communication Patterns
communication:
  synchronous:
    - http_rest: "Direct API calls"
    - grpc: "High-performance RPC"
    - graphql: "Flexible data querying"
  
  asynchronous:
    - message_queue: "Event-driven communication"
    - pub_sub: "Broadcast events"
    - event_sourcing: "Event store"
  
  patterns:
    - saga_pattern: "Distributed transactions"
    - circuit_breaker: "Fault tolerance"
    - bulkhead: "Isolation"
    - retry: "Resilience"
```

### 2. API Gateway Pattern

#### Gateway Architecture
```yaml
# API Gateway Configuration
api_gateway:
  responsibilities:
    - routing: "Route requests to appropriate services"
    - authentication: "Centralized authentication"
    - rate_limiting: "API throttling"
    - caching: "Response caching"
    - monitoring: "Request/response logging"
    - transformation: "Request/response transformation"
  
  routing_rules:
    - pattern: "/api/v1/auth/*"
      service: "auth_service"
      timeout: "5s"
      retries: 3
    
    - pattern: "/api/v1/cameras/*"
      service: "camera_service"
      timeout: "10s"
      retries: 2
    
    - pattern: "/api/v1/analytics/*"
      service: "analytics_service"
      timeout: "15s"
      retries: 1
```

#### Gateway Implementation
```javascript
// API Gateway Implementation
const express = require('express');
const { createProxyMiddleware } = require('http-proxy-middleware');

const app = express();

// Authentication middleware
app.use('/api/v1/*', authenticateToken);

// Rate limiting middleware
app.use('/api/v1/*', rateLimiter);

// Service routing
app.use('/api/v1/auth', createProxyMiddleware({
  target: 'http://auth-service:3001',
  changeOrigin: true,
  timeout: 5000,
  retries: 3
}));

app.use('/api/v1/cameras', createProxyMiddleware({
  target: 'http://camera-service:3002',
  changeOrigin: true,
  timeout: 10000,
  retries: 2
}));

app.use('/api/v1/analytics', createProxyMiddleware({
  target: 'http://analytics-service:3003',
  changeOrigin: true,
  timeout: 15000,
  retries: 1
}));
```

## ğŸ“Š Data Architecture Patterns

### 1. Database per Service Pattern

#### Database Design
```yaml
# Database per Service
databases:
  auth_db:
    service: "auth_service"
    type: "PostgreSQL"
    schema:
      - users
      - user_sessions
      - permissions
      - roles
      - audit_logs
  
  camera_db:
    service: "camera_service"
    type: "PostgreSQL"
    schema:
      - cameras
      - camera_configs
      - counting_results
      - camera_events
      - ai_models
  
  analytics_db:
    service: "analytics_service"
    type: "PostgreSQL + TimescaleDB"
    schema:
      - hourly_analytics
      - daily_analytics
      - monthly_analytics
      - performance_metrics
      - trend_analysis
```

#### Data Consistency
```yaml
# Data Consistency Patterns
consistency_patterns:
  eventual_consistency:
    - saga_pattern: "Distributed transactions"
    - event_sourcing: "Event-driven consistency"
    - cqrs: "Command/Query separation"
  
  strong_consistency:
    - distributed_transactions: "2PC/3PC"
    - consensus_algorithms: "Raft/Paxos"
    - database_sharding: "Horizontal partitioning"
```

### 2. CQRS Pattern (Command Query Responsibility Segregation)

#### CQRS Implementation
```javascript
// Command Handler
class CreateCameraCommandHandler {
  async handle(command) {
    const camera = new Camera({
      name: command.name,
      location: command.location,
      stream_url: command.stream_url
    });
    
    await this.cameraRepository.save(camera);
    
    // Publish event
    await this.eventBus.publish(new CameraCreatedEvent(camera.id));
    
    return camera.id;
  }
}

// Query Handler
class GetCameraQueryHandler {
  async handle(query) {
    return await this.cameraReadRepository.findById(query.cameraId);
  }
}

// Command
class CreateCameraCommand {
  constructor(name, location, stream_url) {
    this.name = name;
    this.location = location;
    this.stream_url = stream_url;
  }
}

// Query
class GetCameraQuery {
  constructor(cameraId) {
    this.cameraId = cameraId;
  }
}
```

#### Event Sourcing
```javascript
// Event Store
class EventStore {
  async saveEvents(aggregateId, events, expectedVersion) {
    const eventStream = await this.getEventStream(aggregateId);
    
    if (eventStream.version !== expectedVersion) {
      throw new ConcurrencyError();
    }
    
    for (const event of events) {
      await this.saveEvent(aggregateId, event);
    }
  }
  
  async getEvents(aggregateId) {
    return await this.eventRepository.findByAggregateId(aggregateId);
  }
}

// Aggregate
class CameraAggregate {
  constructor(id) {
    this.id = id;
    this.name = null;
    this.location = null;
    this.status = 'inactive';
    this.uncommittedEvents = [];
  }
  
  create(name, location, stream_url) {
    this.apply(new CameraCreatedEvent(this.id, name, location, stream_url));
  }
  
  activate() {
    this.apply(new CameraActivatedEvent(this.id));
  }
  
  apply(event) {
    this.handle(event);
    this.uncommittedEvents.push(event);
  }
  
  handle(event) {
    if (event instanceof CameraCreatedEvent) {
      this.name = event.name;
      this.location = event.location;
      this.status = 'active';
    } else if (event instanceof CameraActivatedEvent) {
      this.status = 'active';
    }
  }
}
```

## ğŸ”„ Event-Driven Architecture Patterns

### 1. Event Sourcing Pattern

#### Event Structure
```javascript
// Event Base Class
class DomainEvent {
  constructor(aggregateId, version, timestamp = new Date()) {
    this.aggregateId = aggregateId;
    this.version = version;
    this.timestamp = timestamp;
    this.eventType = this.constructor.name;
  }
}

// Camera Events
class CameraCreatedEvent extends DomainEvent {
  constructor(aggregateId, name, location, stream_url) {
    super(aggregateId, 1);
    this.name = name;
    this.location = location;
    this.stream_url = stream_url;
  }
}

class CameraActivatedEvent extends DomainEvent {
  constructor(aggregateId) {
    super(aggregateId, 2);
  }
}

class CameraDeactivatedEvent extends DomainEvent {
  constructor(aggregateId) {
    super(aggregateId, 3);
  }
}

class CountingResultEvent extends DomainEvent {
  constructor(aggregateId, count, timestamp) {
    super(aggregateId, 4);
    this.count = count;
    this.timestamp = timestamp;
  }
}
```

#### Event Handler
```javascript
// Event Handler
class CameraEventHandler {
  async handle(event) {
    switch (event.eventType) {
      case 'CameraCreatedEvent':
        await this.handleCameraCreated(event);
        break;
      case 'CameraActivatedEvent':
        await this.handleCameraActivated(event);
        break;
      case 'CountingResultEvent':
        await this.handleCountingResult(event);
        break;
    }
  }
  
  async handleCameraCreated(event) {
    // Update read model
    await this.cameraReadRepository.save({
      id: event.aggregateId,
      name: event.name,
      location: event.location,
      status: 'active',
      created_at: event.timestamp
    });
    
    // Send notifications
    await this.notificationService.sendCameraCreatedNotification(event);
  }
  
  async handleCountingResult(event) {
    // Update analytics
    await this.analyticsService.updateCount(event.aggregateId, event.count, event.timestamp);
    
    // Check thresholds
    await this.alertService.checkThresholds(event.aggregateId, event.count);
  }
}
```

### 2. Saga Pattern

#### Saga Implementation
```javascript
// Saga Coordinator
class CameraCreationSaga {
  constructor(cameraService, workerService, notificationService) {
    this.cameraService = cameraService;
    this.workerService = workerService;
    this.notificationService = notificationService;
  }
  
  async execute(command) {
    const sagaId = this.generateSagaId();
    
    try {
      // Step 1: Create camera
      const camera = await this.cameraService.createCamera(command);
      
      // Step 2: Assign worker
      await this.workerService.assignCameraToWorker(camera.id);
      
      // Step 3: Send notification
      await this.notificationService.sendCameraCreatedNotification(camera);
      
      return camera;
    } catch (error) {
      // Compensating actions
      await this.compensate(sagaId, error);
      throw error;
    }
  }
  
  async compensate(sagaId, error) {
    // Rollback actions in reverse order
    try {
      await this.notificationService.rollbackNotification(sagaId);
      await this.workerService.unassignCamera(sagaId);
      await this.cameraService.deleteCamera(sagaId);
    } catch (compensationError) {
      // Log compensation error
      console.error('Compensation failed:', compensationError);
    }
  }
}
```

## ğŸ›¡ï¸ Resilience Patterns

### 1. Circuit Breaker Pattern

#### Circuit Breaker Implementation
```javascript
// Circuit Breaker
class CircuitBreaker {
  constructor(failureThreshold = 5, timeout = 60000) {
    this.failureThreshold = failureThreshold;
    this.timeout = timeout;
    this.failureCount = 0;
    this.lastFailureTime = null;
    this.state = 'CLOSED'; // CLOSED, OPEN, HALF_OPEN
  }
  
  async execute(operation) {
    if (this.state === 'OPEN') {
      if (this.shouldAttemptReset()) {
        this.state = 'HALF_OPEN';
      } else {
        throw new CircuitBreakerOpenError();
      }
    }
    
    try {
      const result = await operation();
      this.onSuccess();
      return result;
    } catch (error) {
      this.onFailure();
      throw error;
    }
  }
  
  onSuccess() {
    this.failureCount = 0;
    this.state = 'CLOSED';
  }
  
  onFailure() {
    this.failureCount++;
    this.lastFailureTime = Date.now();
    
    this.state = 'OPEN';
  }
  
  shouldAttemptReset() {
    return Date.now() - this.lastFailureTime > this.timeout;
  }
}

// Usage
const circuitBreaker = new CircuitBreaker(5, 60000);

const cameraService = {
  async getCamera(id) {
    return await circuitBreaker.execute(async () => {
      return await this.httpClient.get(`/cameras/${id}`);
    });
  }
};
```

### 2. Retry Pattern

#### Retry Implementation
```javascript
// Retry Pattern
class RetryPattern {
  constructor(maxRetries = 3, backoffStrategy = 'exponential') {
    this.maxRetries = maxRetries;
    this.backoffStrategy = backoffStrategy;
  }
  
  async execute(operation) {
    let lastError;
    
    for (let attempt = 0; attempt <= this.maxRetries; attempt++) {
      try {
        return await operation();
      } catch (error) {
        lastError = error;
        
        if (attempt === this.maxRetries) {
          throw lastError;
        }
        
        if (!this.isRetryable(error)) {
          throw error;
        }
        
        await this.delay(this.getBackoffDelay(attempt));
      }
    }
  }
  
  isRetryable(error) {
    const retryableErrors = [
      'ECONNRESET',
      'ETIMEDOUT',
      'ENOTFOUND',
      'ECONNREFUSED'
    ];
    
    return retryableErrors.includes(error.code) || 
           (error.status >= 500 && error.status < 600);
  }
  
  getBackoffDelay(attempt) {
    switch (this.backoffStrategy) {
      case 'exponential':
        return Math.pow(2, attempt) * 1000;
      case 'linear':
        return (attempt + 1) * 1000;
      case 'fixed':
        return 1000;
      default:
        return 1000;
    }
  }
  
  delay(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }
}
```

## ğŸ“Š Repository Pattern

### 1. Repository Implementation

#### Base Repository
```javascript
// Base Repository
class BaseRepository {
  constructor(model) {
    this.model = model;
  }
  
  async findById(id) {
    return await this.model.findByPk(id);
  }
  
  async findAll(options = {}) {
    return await this.model.findAll(options);
  }
  
  async create(data) {
    return await this.model.create(data);
  }
  
  async update(id, data) {
    const entity = await this.findById(id);
    if (!entity) {
      throw new EntityNotFoundError();
    }
    return await entity.update(data);
  }
  
  async delete(id) {
    const entity = await this.findById(id);
    if (!entity) {
      throw new EntityNotFoundError();
    }
    await entity.destroy();
  }
  
  async findOne(where) {
    return await this.model.findOne({ where });
  }
  
  async count(where = {}) {
    return await this.model.count({ where });
  }
}
```

#### Camera Repository
```javascript
// Camera Repository
class CameraRepository extends BaseRepository {
  constructor(cameraModel) {
    super(cameraModel);
  }
  
  async findByStatus(status) {
    return await this.findAll({
      where: { status },
      include: ['worker', 'ai_model']
    });
  }
  
  async findByLocation(location) {
    return await this.findAll({
      where: { location },
      include: ['worker', 'ai_model']
    });
  }
  
  async findActiveCameras() {
    return await this.findByStatus('active');
  }
  
  async updateStatus(id, status) {
    return await this.update(id, { status });
  }
  
  async assignWorker(cameraId, workerId) {
    return await this.update(cameraId, { worker_id: workerId });
  }
  
  async getCameraWithAnalytics(id) {
    return await this.model.findByPk(id, {
      include: [
        'worker',
        'ai_model',
        'counting_results',
        'camera_events'
      ]
    });
  }
}
```

## ğŸ”§ Dependency Injection Pattern

### 1. DI Container

#### Container Implementation
```javascript
// Dependency Injection Container
class Container {
  constructor() {
    this.services = new Map();
    this.singletons = new Map();
  }
  
  register(name, factory, options = {}) {
    this.services.set(name, { factory, options });
  }
  
  resolve(name) {
    const service = this.services.get(name);
    if (!service) {
      throw new Error(`Service ${name} not registered`);
    }
    
    if (service.options.singleton) {
      if (!this.singletons.has(name)) {
        this.singletons.set(name, service.factory(this));
      }
      return this.singletons.get(name);
    }
    
    return service.factory(this);
  }
}

// Service Registration
const container = new Container();

// Register services
container.register('database', (container) => {
  return new Database(config.database);
}, { singleton: true });

container.register('cameraRepository', (container) => {
  const database = container.resolve('database');
  return new CameraRepository(database.models.Camera);
}, { singleton: true });

container.register('cameraService', (container) => {
  const cameraRepository = container.resolve('cameraRepository');
  const eventBus = container.resolve('eventBus');
  return new CameraService(cameraRepository, eventBus);
}, { singleton: true });

container.register('cameraController', (container) => {
  const cameraService = container.resolve('cameraService');
  return new CameraController(cameraService);
}, { singleton: true });
```

## ğŸ§ª Testing Patterns

### 1. Unit Testing Patterns

#### Service Testing
```javascript
// Camera Service Test
describe('CameraService', () => {
  let cameraService;
  let mockCameraRepository;
  let mockEventBus;
  
  beforeEach(() => {
    mockCameraRepository = {
      create: jest.fn(),
      findById: jest.fn(),
      update: jest.fn(),
      delete: jest.fn()
    };
    
    mockEventBus = {
      publish: jest.fn()
    };
    
    cameraService = new CameraService(mockCameraRepository, mockEventBus);
  });
  
  describe('createCamera', () => {
    it('should create camera successfully', async () => {
      const cameraData = {
        name: 'Test Camera',
        location: 'Test Location',
        stream_url: 'rtsp://test.com/stream'
      };
      
      const expectedCamera = { id: 1, ...cameraData, status: 'active' };
      mockCameraRepository.create.mockResolvedValue(expectedCamera);
      
      const result = await cameraService.createCamera(cameraData);
      
      expect(mockCameraRepository.create).toHaveBeenCalledWith(cameraData);
      expect(mockEventBus.publish).toHaveBeenCalledWith(
        expect.objectContaining({
          eventType: 'CameraCreatedEvent',
          aggregateId: 1
        })
      );
      expect(result).toEqual(expectedCamera);
    });
    
    it('should throw error when camera creation fails', async () => {
      const cameraData = { name: 'Test Camera' };
      const error = new Error('Database error');
      mockCameraRepository.create.mockRejectedValue(error);
      
      await expect(cameraService.createCamera(cameraData)).rejects.toThrow('Database error');
    });
  });
});
```

### 2. Integration Testing Patterns

#### API Integration Test
```javascript
// API Integration Test
describe('Camera API Integration', () => {
  let app;
  let server;
  
  beforeAll(async () => {
    app = express();
    setupRoutes(app);
    server = app.listen(0);
  });
  
  afterAll(async () => {
    await server.close();
  });
  
  describe('POST /api/v1/cameras', () => {
    it('should create camera successfully', async () => {
      const cameraData = {
        name: 'Integration Test Camera',
        location: 'Test Location',
        stream_url: 'rtsp://test.com/stream'
      };
      
      const response = await request(app)
        .post('/api/v1/cameras')
        .set('Authorization', `Bearer ${validToken}`)
        .send(cameraData)
        .expect(201);
      
      expect(response.body.success).toBe(true);
      expect(response.body.data.name).toBe(cameraData.name);
      expect(response.body.data.status).toBe('active');
    });
    
    it('should return 400 for invalid data', async () => {
      const invalidData = { name: '' };
      
      const response = await request(app)
        .post('/api/v1/cameras')
        .set('Authorization', `Bearer ${validToken}`)
        .send(invalidData)
        .expect(400);
      
      expect(response.body.success).toBe(false);
      expect(response.body.errors).toBeDefined();
    });
  });
});
```

## ğŸš€ Implementation Roadmap

### Phase 1: Foundation (Weeks 1-2)
- [ ] Setup microservices architecture
- [ ] Implement API Gateway
- [ ] Setup database per service
- [ ] Implement basic repository pattern

### Phase 2: Advanced Patterns (Weeks 3-4)
- [ ] Implement CQRS pattern
- [ ] Setup event sourcing
- [ ] Implement saga pattern
- [ ] Add circuit breaker pattern

### Phase 3: Testing & Optimization (Weeks 5-6)
- [ ] Implement comprehensive testing
- [ ] Add monitoring and logging
- [ ] Performance optimization
- [ ] Documentation review

---

**TÃ i liá»‡u nÃ y cung cáº¥p cÃ¡c patterns kiáº¿n trÃºc backend toÃ n diá»‡n cho há»‡ thá»‘ng AI Camera Counting, Ä‘áº£m báº£o tÃ­nh scalable, maintainable vÃ  reliable.**
