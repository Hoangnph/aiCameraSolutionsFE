# Data Flow System - Comprehensive Theory & Implementation Guide

## 📊 Tổng quan hệ thống Data Flow

Hệ thống Data Flow trong AI Camera Counting được thiết kế theo kiến trúc microservices với 3 thành phần chính:
- **Frontend (React)**: Dashboard UI với real-time updates
- **Backend Services**: beAuth (Authentication) + beCamera (Camera Processing)
- **Infrastructure**: Database, Cache, Message Queue, WebSocket

Hệ thống đảm bảo tính liên tục, bảo mật và hiệu suất cao trong môi trường production với khả năng xử lý hàng trăm camera streams đồng thời.

## 🏗️ Data Flow Architecture Overview

### High-Level Data Flow Architecture

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              DATA FLOW ARCHITECTURE OVERVIEW                     │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                              DATA INGESTION LAYER                           │ │
│  │                                                                             │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │ │
│  │  │   Camera    │  │   IoT       │  │   External  │  │   Manual    │        │ │
│  │  │   Streams   │  │   Devices   │  │   APIs      │  │   Input     │        │ │
│  │  │   (RTSP)    │  │   (Sensors) │  │   (3rd Party)│ │   (Admin)   │        │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘        │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
│                                    │                                             │
│                                    ▼                                             │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                              PROCESSING LAYER                               │ │
│  │                                                                             │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │ │
│  │  │   Worker    │  │   AI Model  │  │   Stream    │  │   Analytics │        │ │
│  │  │   Pool      │  │   Engine    │  │   Processor │  │   Engine    │        │ │
│  │  │             │  │             │  │             │  │             │        │ │
│  │  │ • Frame     │  │ • Detection │  │ • Real-time │  │ • Batch     │        │ │
│  │  │   Capture   │  │ • Counting  │  │ • Processing│  │ • Processing│        │ │
│  │  │ • Preprocess│  │ • Tracking  │  │ • Filtering │  │ • Aggregation│       │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘        │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
│                                    │                                             │
│                                    ▼                                             │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                              STORAGE LAYER                                  │ │
│  │                                                                             │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │ │
│  │  │   Primary   │  │   Cache     │  │   Message   │  │   File      │        │ │
│  │  │   Database  │  │   Layer     │  │   Queue     │  │   Storage   │        │ │
│  │  │   (PostgreSQL)│ │   (Redis)   │  │   (RabbitMQ)│  │   (S3/MinIO)│        │ │
│  │  │             │  │             │  │             │  │             │        │ │
│  │  │ • Structured│  │ • Real-time │  │ • Event     │  │ • Media     │        │ │
│  │  │   Data      │  │ • Session   │  │ • Queue     │  │ • Logs      │        │ │
│  │  │ • Analytics │  │ • Cache     │  │ • Dead      │  │ • Backups   │        │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘        │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
│                                    │                                             │
│                                    ▼                                             │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                              DELIVERY LAYER                                 │ │
│  │                                                                             │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │ │
│  │  │   WebSocket │  │   REST API  │  │   GraphQL   │  │   Event     │        │ │
│  │  │   Service   │  │   Gateway   │  │   API       │  │   Streaming │        │ │
│  │  │             │  │             │  │             │  │             │        │ │
│  │  │ • Real-time │  │ • CRUD      │  │ • Flexible  │  │ • Kafka     │        │ │
│  │  │ • Live      │  │ • Reports   │  │ • Queries   │  │ • Pub/Sub   │        │ │
│  │  │ • Updates   │  │ • Analytics │  │ • Schema    │  │ • Streams   │        │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘        │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                              CONSUMPTION LAYER                              │ │
│  │                                                                             │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │ │
│  │  │   Web       │  │   Mobile    │  │   Desktop   │  │   External   │        │ │
│  │  │   Dashboard │  │   App       │  │   Client    │  │   Systems    │        │ │
│  │  │   (React)   │  │   (React)   │  │   (Electron)│  │   (APIs)    │        │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘        │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### Real-Time Data Processing Flow

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              REAL-TIME DATA PROCESSING FLOW                     │
│                                                                                 │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐      │
│  │   Camera    │    │   Worker    │    │   AI Model  │    │   beCamera  │      │
│  │   Device    │    │   Pool      │    │   Engine    │    │   Service   │      │
│  └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘      │
│         │                   │                   │                   │          │
│         │ 1. RTSP Stream    │                   │                   │          │
│         │ (1920x1080, 25fps)│                   │                   │          │
│         │──────────────────►│                   │                   │          │
│         │                   │                   │                   │          │
│         │                   │ 2. Frame Capture  │                   │          │
│         │                   │ & Preprocessing   │                   │          │
│         │                   │ (Resize, Normalize)│                   │          │
│         │                   │──────────────────►│                   │          │
│         │                   │                   │                   │          │
│         │                   │                   │ 3. AI Detection   │          │
│         │                   │                   │ (YOLO/SSD Model)  │          │
│         │                   │                   │ (Person Detection)│          │
│         │                   │                   │──────────────────►│          │
│         │                   │                   │                   │          │
│         │                   │                   │ 4. Counting Logic │          │
│         │                   │                   │ (In/Out Tracking) │          │
│         │                   │                   │ (Zone Analysis)   │          │
│         │                   │                   │◄──────────────────┤          │
│         │                   │                   │                   │          │
│         │                   │ 5. Results        │                   │          │
│         │                   │ (Count, Confidence)│                   │          │
│         │                   │──────────────────►│                   │          │
│         │                   │                   │                   │          │
│         │                   │                   │ 6. Store & Cache  │          │
│         │                   │                   │ (PostgreSQL/Redis)│          │
│         │                   │                   │◄──────────────────┤          │
│         │                   │                   │                   │          │
│         │                   │ 7. Real-time      │                   │          │
│         │                   │ Broadcast         │                   │          │
│         │                   │ (WebSocket)       │                   │          │
│         │                   │◄──────────────────┤                   │          │
│         │                   │                   │                   │          │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### Batch Processing Flow

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              BATCH PROCESSING FLOW                              │
│                                                                                 │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐      │
│  │   Scheduler │    │   Analytics │    │   Data      │    │   Reporting │      │
│  │   (Cron)    │    │   Engine    │    │   Warehouse │    │   Service   │      │
│  └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘      │
│         │                   │                   │                   │          │
│         │ 1. Scheduled      │                   │                   │          │
│         │ Trigger           │                   │                   │          │
│         │ (Hourly/Daily)    │                   │                   │          │
│         │──────────────────►│                   │                   │          │
│         │                   │                   │                   │          │
│         │                   │ 2. Query Raw Data │                   │          │
│         │                   │ (Time Range)      │                   │          │
│         │                   │──────────────────►│                   │          │
│         │                   │                   │                   │          │
│         │                   │                   │ 3. Raw Data       │          │
│         │                   │                   │ (Counting Results)│          │
│         │                   │                   │◄──────────────────┤          │
│         │                   │                   │                   │          │
│         │                   │ 4. Data Processing│                   │          │
│         │                   │ (Aggregation)     │                   │          │
│         │                   │ (Calculations)    │                   │          │
│         │                   │ (Trend Analysis)  │                   │          │
│         │                   │──────────────────►│                   │          │
│         │                   │                   │                   │          │
│         │                   │                   │ 5. Store Analytics│          │
│         │                   │                   │ (Processed Data)  │          │
│         │                   │                   │◄──────────────────┤          │
│         │                   │                   │                   │          │
│         │                   │ 6. Generate       │                   │          │
│         │                   │ Reports           │                   │          │
│         │                   │ (PDF/Excel)       │                   │          │
│         │                   │──────────────────►│                   │          │
│         │                   │                   │                   │          │
│         │                   │                   │ 7. Cache Results  │          │
│         │                   │                   │ (Redis)           │          │
│         │                   │                   │◄──────────────────┤          │
│         │                   │                   │                   │          │
│         │                   │ 8. Notify Users   │                   │          │
│         │                   │ (Email/Webhook)   │                   │          │
│         │                   │◄──────────────────┤                   │          │
│         │                   │                   │                   │          │
│         │                   │                   │                   │ 4. Report│
│         │                   │                   │                   │ Quality│
│         │                   │                   │                   │◄─────┤ │
│         │                   │                   │                   │      │ │
│         │                   │ 5. Generate       │                   │      │ │
│         │                   │ Alerts            │                   │      │ │
│         │                   │ (If Issues)       │                   │      │ │
│         │                   │◄──────────────────┤                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 6. Report│
│         │                   │                   │                   │ Quality│
│         │                   │                   │                   │◄─────┤ │
│         │                   │                   │                   │      │ │
│         │                   │ 7. Cache Results  │                   │      │ │
│         │                   │ (Redis)           │                   │      │ │
│         │                   │◄──────────────────┤                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │ 8. Notify Users   │                   │      │ │
│         │                   │ (Email/Webhook)   │                   │      │ │
│         │                   │◄──────────────────┤                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 7. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄─────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 8. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄─────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 9. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄─────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 10. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 11. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 12. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 13. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 14. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 15. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 16. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 17. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 18. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 19. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 20. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 21. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 22. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 23. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 24. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 25. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 26. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 27. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 28. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 29. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 30. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 31. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 32. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 33. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 34. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 35. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 36. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 37. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 38. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 39. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 40. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 41. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 42. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 43. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 44. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 45. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 46. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 47. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 48. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 49. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 50. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 51. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 52. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 53. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 54. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 55. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 56. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 57. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 58. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 59. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 60. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 61. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 62. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 63. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 64. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 65. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 66. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 67. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 68. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 69. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 70. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 71. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 72. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 73. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 74. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 75. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 76. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 77. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 78. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 79. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 80. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 81. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 82. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 83. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 84. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 85. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 86. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 87. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 88. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 89. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 90. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 91. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 92. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 93. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 94. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 95. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 96. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 97. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 98. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 99. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄──────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 100. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 101. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 102. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 103. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 104. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 105. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 106. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 107. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 108. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 109. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 110. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 111. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 112. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 113. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 114. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 115. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 116. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 117. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 118. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 119. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 120. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 121. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 122. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 123. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 124. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 125. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 126. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 127. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 128. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 129. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 130. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 131. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 132. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 133. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 134. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 135. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 136. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 137. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 138. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 139. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 140. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 141. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 142. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 143. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 144. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 145. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 146. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 147. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 148. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │ 149. Notify│
│         │                   │                   │                   │ Users │
│         │                   │                   │                   │◄───────┤ │
│         │                   │                   │                   │      │ │
│         │                   │                   │                   │      │ │
#### Advantages:
- **Simplified Management**: Một database để quản lý
- **Data Consistency**: Đảm bảo tính nhất quán
- **Reduced Complexity**: Giảm độ phức tạp deployment
- **Cost Effective**: Tiết kiệm chi phí infrastructure
- **Shared Authentication**: Tái sử dụng user management

### 2. Database Schema Design

#### Core Tables

```sql
-- User Management (beAuth)
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    first_name VARCHAR(50),
    last_name VARCHAR(50),
    role user_role DEFAULT 'user',
    is_active BOOLEAN DEFAULT TRUE,
    email_verified BOOLEAN DEFAULT FALSE,
    last_login TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE user_sessions (
    id SERIAL PRIMARY KEY,
    user_id INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    session_token VARCHAR(255) UNIQUE NOT NULL,
    refresh_token VARCHAR(255) UNIQUE NOT NULL,
    expires_at TIMESTAMP NOT NULL,
    ip_address INET,
    user_agent TEXT,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Camera Management (beCamera)
CREATE TABLE cameras (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    description TEXT,
    stream_url VARCHAR(500) NOT NULL,
    stream_type VARCHAR(20) DEFAULT 'rtsp',
    location VARCHAR(200),
    coordinates POINT,
    status camera_status DEFAULT 'offline',
    worker_id VARCHAR(50),
    settings JSONB DEFAULT '{}',
    metadata JSONB DEFAULT '{}',
    security_config JSONB DEFAULT '{}',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Real-time Counting Results
CREATE TABLE counting_results (
    id SERIAL PRIMARY KEY,
    camera_id INTEGER NOT NULL REFERENCES cameras(id) ON DELETE CASCADE,
    timestamp TIMESTAMP NOT NULL,
    people_count INTEGER NOT NULL DEFAULT 0,
    people_in INTEGER NOT NULL DEFAULT 0,
    people_out INTEGER NOT NULL DEFAULT 0,
    confidence_score DECIMAL(5,4),
    detection_count INTEGER DEFAULT 0,
    false_positives INTEGER DEFAULT 0,
    false_negatives INTEGER DEFAULT 0,
    processing_time_ms INTEGER,
    frame_quality_score DECIMAL(5,4),
    model_id INTEGER REFERENCES ai_models(id),
    worker_id VARCHAR(50),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Camera Events
CREATE TABLE camera_events (
    id SERIAL PRIMARY KEY,
    camera_id INTEGER NOT NULL REFERENCES cameras(id) ON DELETE CASCADE,
    event_type VARCHAR(50) NOT NULL,
    event_data JSONB,
    timestamp TIMESTAMP NOT NULL,
    confidence_score DECIMAL(5,4),
    severity event_severity DEFAULT 'low',
    is_processed BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- System Alerts
CREATE TABLE system_alerts (
    id SERIAL PRIMARY KEY,
    alert_type VARCHAR(50) NOT NULL,
    severity alert_severity NOT NULL,
    title VARCHAR(200) NOT NULL,
    message TEXT NOT NULL,
    alert_data JSONB,
    source_service VARCHAR(50),
    camera_id INTEGER REFERENCES cameras(id),
    user_id INTEGER REFERENCES users(id),
    is_resolved BOOLEAN DEFAULT FALSE,
    resolved_at TIMESTAMP,
    resolved_by INTEGER REFERENCES users(id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Worker Management
CREATE TABLE workers (
    id VARCHAR(50) PRIMARY KEY,
    host VARCHAR(100) NOT NULL,
    port INTEGER NOT NULL,
    status worker_status DEFAULT 'offline',
    cpu_usage DECIMAL(5,2),
    memory_usage DECIMAL(5,2),
    camera_count INTEGER DEFAULT 0,
    max_cameras INTEGER DEFAULT 10,
    last_heartbeat TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- AI Models
CREATE TABLE ai_models (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    version VARCHAR(20) NOT NULL,
    model_path VARCHAR(500) NOT NULL,
    model_type VARCHAR(50) NOT NULL,
    accuracy_score DECIMAL(5,4),
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### Analytics Tables

```sql
-- Hourly Analytics
CREATE TABLE hourly_analytics (
    id SERIAL PRIMARY KEY,
    camera_id INTEGER NOT NULL REFERENCES cameras(id) ON DELETE CASCADE,
    date DATE NOT NULL,
    hour INTEGER NOT NULL,
    total_people_count INTEGER DEFAULT 0,
    total_people_in INTEGER DEFAULT 0,
    total_people_out INTEGER DEFAULT 0,
    peak_count INTEGER DEFAULT 0,
    peak_time TIMESTAMP,
    avg_confidence_score DECIMAL(5,4),
    total_events INTEGER DEFAULT 0,
    error_count INTEGER DEFAULT 0,
    uptime_percentage DECIMAL(5,2),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(camera_id, date, hour)
);

-- Daily Analytics
CREATE TABLE daily_analytics (
    id SERIAL PRIMARY KEY,
    camera_id INTEGER NOT NULL REFERENCES cameras(id) ON DELETE CASCADE,
    date DATE NOT NULL,
    total_people_count INTEGER DEFAULT 0,
    total_people_in INTEGER DEFAULT 0,
    total_people_out INTEGER DEFAULT 0,
    peak_hour_count INTEGER DEFAULT 0,
    peak_hour INTEGER,
    avg_hourly_count DECIMAL(8,2),
    total_events INTEGER DEFAULT 0,
    total_alerts INTEGER DEFAULT 0,
    uptime_percentage DECIMAL(5,2),
    avg_confidence_score DECIMAL(5,4),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(camera_id, date)
);

-- Monthly Analytics
CREATE TABLE monthly_analytics (
    id SERIAL PRIMARY KEY,
    camera_id INTEGER NOT NULL REFERENCES cameras(id) ON DELETE CASCADE,
    year INTEGER NOT NULL,
    month INTEGER NOT NULL,
    total_people_count INTEGER DEFAULT 0,
    total_people_in INTEGER DEFAULT 0,
    total_people_out INTEGER DEFAULT 0,
    peak_day_count INTEGER DEFAULT 0,
    peak_day DATE,
    avg_daily_count DECIMAL(8,2),
    total_events INTEGER DEFAULT 0,
    total_alerts INTEGER DEFAULT 0,
    uptime_percentage DECIMAL(5,2),
    avg_confidence_score DECIMAL(5,4),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(camera_id, year, month)
);
```

#### Logging Tables

```sql
-- Application Logs
CREATE TABLE application_logs (
    id SERIAL PRIMARY KEY,
    timestamp TIMESTAMP NOT NULL,
    level VARCHAR(10) NOT NULL,
    service VARCHAR(50) NOT NULL,
    message TEXT NOT NULL,
    trace_id VARCHAR(36),
    span_id VARCHAR(36),
    metadata JSONB,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Performance Logs
CREATE TABLE performance_logs (
    id SERIAL PRIMARY KEY,
    service_name VARCHAR(50) NOT NULL,
    endpoint VARCHAR(200),
    method VARCHAR(10),
    response_time_ms INTEGER,
    status_code INTEGER,
    request_size INTEGER,
    response_size INTEGER,
    user_id INTEGER REFERENCES users(id),
    ip_address INET,
    user_agent TEXT,
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Error Logs
CREATE TABLE error_logs (
    id SERIAL PRIMARY KEY,
    timestamp TIMESTAMP NOT NULL,
    service VARCHAR(50) NOT NULL,
    error_type VARCHAR(100) NOT NULL,
    error_message TEXT NOT NULL,
    stack_trace TEXT,
    context JSONB,
    user_id INTEGER REFERENCES users(id),
    camera_id INTEGER REFERENCES cameras(id),
    severity error_severity DEFAULT 'medium',
    is_resolved BOOLEAN DEFAULT FALSE,
    resolved_at TIMESTAMP,
    resolved_by INTEGER REFERENCES users(id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Audit Logs
CREATE TABLE audit_logs (
    id SERIAL PRIMARY KEY,
    timestamp TIMESTAMP NOT NULL,
    user_id INTEGER REFERENCES users(id),
    action VARCHAR(100) NOT NULL,
    resource_type VARCHAR(50),
    resource_id INTEGER,
    old_values JSONB,
    new_values JSONB,
    ip_address INET,
    user_agent TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 3. Database Optimization

#### Indexing Strategy
```sql
-- Performance Indexes
CREATE INDEX idx_counting_results_camera_timestamp ON counting_results(camera_id, timestamp);
CREATE INDEX idx_counting_results_timestamp ON counting_results(timestamp);
CREATE INDEX idx_camera_events_camera_timestamp ON camera_events(camera_id, timestamp);
CREATE INDEX idx_camera_events_type_timestamp ON camera_events(event_type, timestamp);
CREATE INDEX idx_application_logs_timestamp ON application_logs(timestamp);
CREATE INDEX idx_application_logs_service_level ON application_logs(service, level);
CREATE INDEX idx_performance_logs_timestamp ON performance_logs(timestamp);
CREATE INDEX idx_error_logs_timestamp ON error_logs(timestamp);
CREATE INDEX idx_error_logs_service_severity ON error_logs(service, severity);
CREATE INDEX idx_audit_logs_user_timestamp ON audit_logs(user_id, timestamp);

-- Analytics Indexes
CREATE INDEX idx_hourly_analytics_camera_date ON hourly_analytics(camera_id, date);
CREATE INDEX idx_daily_analytics_camera_date ON daily_analytics(camera_id, date);
CREATE INDEX idx_monthly_analytics_camera_year_month ON monthly_analytics(camera_id, year, month);

-- User Management Indexes
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_users_username ON users(username);
CREATE INDEX idx_user_sessions_token ON user_sessions(session_token);
CREATE INDEX idx_user_sessions_user_id ON user_sessions(user_id);
```

## 🔄 Data Processing Workflows

### 1. Real-time Processing Workflow

```
1. Camera Stream Ingestion
   ├── Stream Validation
   ├── Health Check
   └── Load Balancing

2. Worker Assignment
   ├── Worker Selection
   ├── Model Loading
   └── Resource Allocation

3. Frame Processing
   ├── Frame Capture
   ├── Preprocessing
   ├── AI Detection
   └── Post-processing

4. Result Processing
   ├── Data Validation
   ├── Counting Logic
   ├── Confidence Scoring
   └── Quality Assessment

5. Storage Operations
   ├── Redis Cache Update
   ├── Database Insertion
   ├── Event Generation
   └── Log Recording

6. Output Distribution
   ├── WebSocket Broadcasting
   ├── API Response
   ├── Alert Generation
   └── Metrics Update
```

### 2. Batch Processing Workflow

```
1. Scheduled Trigger
   ├── Time-based Trigger
   ├── Dependency Check
   └── Resource Availability

2. Data Collection
   ├── Raw Data Extraction
   ├── Data Validation
   └── Quality Check

3. Aggregation Processing
   ├── Time-based Aggregation
   ├── Statistical Calculation
   └── Trend Analysis

4. Analytics Processing
   ├── Performance Metrics
   ├── Business Intelligence
   └── Predictive Analytics

5. Report Generation
   ├── Report Templates
   ├── Data Visualization
   └── Format Conversion

6. Distribution
   ├── Email Notifications
   ├── API Endpoints
   ├── Dashboard Updates
   └── External Systems
```

### 3. Authentication Workflow

```
1. User Login
   ├── Credential Validation
   ├── Password Verification
   └── User Status Check

2. Token Generation
   ├── JWT Access Token
   ├── Refresh Token
   └── Session Creation

3. Session Management
   ├── Redis Session Storage
   ├── Token Expiration
   └── Auto-refresh Logic

4. Authorization
   ├── Role-based Access
   ├── Permission Check
   └── Resource Validation

5. Audit Logging
   ├── Login Events
   ├── Access Attempts
   └── Security Events
```

## 🔐 Security Architecture

### 1. Data Security

#### Encryption Strategy
- **Data in Transit**: TLS 1.3 cho tất cả network communications
- **Data at Rest**: AES-256 encryption cho database và file storage
- **API Security**: JWT tokens với short expiration (1 hour)
- **Stream Security**: Encrypted camera streams với authentication

#### Access Control
- **Role-based Access Control (RBAC)**: Phân quyền theo vai trò (admin, user, viewer)
- **API Authentication**: JWT tokens với refresh mechanism
- **Database Access**: Connection pooling với authentication
- **Audit Logging**: Log tất cả access attempts và changes

### 2. Network Security

#### Network Segmentation
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Internet      │    │   DMZ           │    │   Internal      │
│                 │    │                 │    │   Network       │
│ • Public APIs   │───►│ • Load Balancer │───►│ • Application   │
│ • Web Access    │    │ • Web Server    │    │ • Database      │
│ • Mobile Apps   │    │ • API Gateway   │    │ • Workers       │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

#### Security Measures
- **Firewall Rules**: Strict firewall policies cho từng layer
- **DDoS Protection**: Rate limiting và traffic filtering
- **SSL/TLS Termination**: Centralized SSL management
- **VPN Access**: Secure remote access cho admin

## 📈 Monitoring & Observability

### 1. Monitoring Architecture

#### Infrastructure Monitoring
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Infrastructure│    │   Application   │    │   Business      │
│   Monitoring    │    │   Monitoring    │    │   Monitoring    │
│                 │    │                 │    │                 │
│ • CPU Usage     │    │ • Response Time │    │ • User Activity │
│ • Memory Usage  │    │ • Error Rates   │    │ • Feature Usage │
│ • Disk Usage    │    │ • Throughput    │    │ • Conversion    │
│ • Network I/O   │    │ • Availability  │    │ • Revenue       │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

#### Monitoring Stack
- **Metrics Collection**: Prometheus, Grafana
- **Log Aggregation**: ELK Stack (Elasticsearch, Logstash, Kibana)
- **Tracing**: Jaeger, Zipkin
- **Alerting**: PagerDuty, Slack, Email

### 2. Key Metrics

#### System Metrics
- **Performance**: Response time, throughput, latency
- **Availability**: Uptime, downtime, MTTR
- **Resource Usage**: CPU, memory, disk, network
- **Error Rates**: Error percentage, failure rates

#### Business Metrics
- **User Engagement**: Active users, session duration
- **Feature Usage**: Camera usage, analytics usage
- **Quality Metrics**: Detection accuracy, false positives
- **Operational Metrics**: Processing efficiency, cost per transaction

### 3. Alerting Strategy

#### Alert Levels
- **Critical**: System failures, security breaches
- **High**: Performance degradation, high error rates
- **Medium**: Resource usage warnings, capacity alerts
- **Low**: Informational alerts, maintenance notifications

#### Alert Channels
- **Immediate**: SMS, Phone calls
- **High Priority**: Slack, Email
- **Standard**: Email, Dashboard
- **Informational**: Dashboard, Logs

## 🚀 Performance Optimization

### 1. Caching Strategy

#### Multi-tier Caching
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Application   │    │   Redis Cache   │    │   Database      │
│   Cache (L1)    │    │   (L2)          │    │   (L3)          │
│                 │    │                 │    │                 │
│ • In-memory     │───►│ • Session Data  │───►│ • Persistent    │
│ • Object Cache  │    │ • Real-time     │    │ • Historical    │
│ • Query Cache   │    │ • Analytics     │    │ • Archive       │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

#### Cache Policies
- **TTL Strategy**: Time-based expiration
- **LRU Eviction**: Least Recently Used eviction
- **Cache Warming**: Pre-loading frequently accessed data
- **Cache Invalidation**: Smart invalidation strategies

### 2. Database Optimization

#### Query Optimization
- **Index Strategy**: Optimal indexing cho common queries
- **Query Tuning**: Optimized SQL queries
- **Connection Pooling**: Efficient connection management
- **Read Replicas**: Load balancing cho read operations

#### Performance Tuning
- **Buffer Management**: Optimal buffer pool sizing
- **Query Cache**: Database-level query caching
- **Partitioning**: Table partitioning cho large datasets
- **Compression**: Data compression cho storage efficiency

## 🔄 Data Lifecycle Management

### 1. Data Lifecycle Stages

#### Active Data (0-30 days)
- **Storage**: Primary database, Redis cache
- **Access**: Real-time access, frequent queries
- **Backup**: Daily backups, point-in-time recovery
- **Performance**: Optimized cho fast access

#### Warm Data (30 days - 1 year)
- **Storage**: Secondary database, compressed storage
- **Access**: Periodic access, batch queries
- **Backup**: Weekly backups, incremental backups
- **Performance**: Balanced performance và cost

#### Cold Data (1+ years)
- **Storage**: Archive storage, object storage
- **Access**: Rare access, compliance queries
- **Backup**: Monthly backups, long-term retention
- **Performance**: Cost-optimized storage

### 2. Data Retention Policies

#### Retention Schedule
- **Real-time Data**: 30 days trong primary storage
- **Analytics Data**: 1 year trong secondary storage
- **Log Data**: 90 days trong primary, 1 year trong archive
- **Audit Data**: 7 years cho compliance
- **Backup Data**: 30 days cho operational, 1 year cho compliance

### 3. Data Quality Management

#### Quality Metrics
- **Accuracy**: Data correctness và precision
- **Completeness**: Data completeness và coverage
- **Consistency**: Data consistency across systems
- **Timeliness**: Data freshness và currency
- **Validity**: Data format và range validation

#### Quality Assurance
- **Data Validation**: Automated data validation rules
- **Quality Monitoring**: Real-time quality monitoring
- **Data Cleansing**: Automated data cleansing processes
- **Quality Reporting**: Regular quality reports và dashboards

## 🎯 Production Readiness Checklist

### 1. Infrastructure Readiness
- [ ] **High Availability**: Multi-zone deployment
- [ ] **Load Balancing**: Proper load balancer configuration
- [ ] **Auto-scaling**: Auto-scaling policies configured
- [ ] **Monitoring**: Comprehensive monitoring setup
- [ ] **Backup Strategy**: Automated backup và recovery
- [ ] **Security**: Security measures implemented
- [ ] **Compliance**: Compliance requirements met

### 2. Application Readiness
- [ ] **Error Handling**: Comprehensive error handling
- [ ] **Logging**: Structured logging implemented
- [ ] **Performance**: Performance benchmarks met
- [ ] **Testing**: Comprehensive test coverage
- [ ] **Documentation**: Complete documentation
- [ ] **Deployment**: Automated deployment pipeline
- [ ] **Rollback**: Rollback procedures in place

### 3. Operational Readiness
- [ ] **Monitoring**: Real-time monitoring và alerting
- [ ] **Incident Response**: Incident response procedures
- [ ] **Support**: 24/7 support coverage
- [ ] **Training**: Team training completed
- [ ] **Disaster Recovery**: Disaster recovery plan
- [ ] **Capacity Planning**: Capacity planning completed
- [ ] **Performance Tuning**: Performance optimization completed

## 📊 Khía cạnh Production cần bổ sung

### 1. Disaster Recovery & Business Continuity
- **Backup Strategy**: Automated backup với point-in-time recovery
- **Failover Procedures**: Automated failover cho critical services
- **Data Replication**: Cross-region data replication
- **Recovery Testing**: Regular disaster recovery testing

### 2. Compliance & Governance
- **Data Privacy**: GDPR, CCPA compliance
- **Audit Trails**: Comprehensive audit logging
- **Data Classification**: Data sensitivity classification
- **Retention Policies**: Automated data lifecycle management

### 3. Performance & Scalability
- **Load Testing**: Comprehensive load testing
- **Capacity Planning**: Predictive capacity planning
- **Performance Monitoring**: Real-time performance monitoring
- **Auto-scaling**: Intelligent auto-scaling policies

### 4. Security & Risk Management
- **Security Monitoring**: Real-time security monitoring
- **Vulnerability Management**: Regular security assessments
- **Incident Response**: Security incident response procedures
- **Access Management**: Comprehensive access control

### 5. Operational Excellence
- **Change Management**: Controlled deployment procedures
- **Configuration Management**: Infrastructure as Code
- **Monitoring & Alerting**: Proactive monitoring
- **Documentation**: Complete operational documentation

## 🔧 Implementation Guidelines

### 1. Frontend Implementation
- **State Management**: Use Context API + local state
- **Error Handling**: Global error boundary + retry logic
- **Performance**: Code splitting, lazy loading, memoization
- **Security**: Input validation, XSS prevention, CSRF protection
- **WebSocket Integration**: Real-time data streaming với reconnection logic
- **API Client**: Centralized API client với authentication handling

### 2. Backend Implementation
- **API Design**: RESTful APIs với consistent response format
- **Error Handling**: Structured error responses với proper HTTP codes
- **Validation**: Input validation với Pydantic models
- **Security**: JWT authentication, rate limiting, input sanitization
- **Worker Pool**: Scalable worker pool với load balancing
- **WebSocket Service**: Real-time broadcasting với connection management

### 3. Database Implementation
- **Connection Pooling**: Efficient connection management
- **Transactions**: Proper transaction handling cho data consistency
- **Migrations**: Automated database migrations
- **Backup**: Automated backup procedures
- **Indexing**: Strategic indexing cho performance optimization
- **Partitioning**: Table partitioning cho large datasets

### 4. Monitoring Implementation
- **Metrics**: Custom metrics cho business KPIs
- **Logging**: Structured logging với correlation IDs
- **Tracing**: Distributed tracing cho request flows
- **Alerting**: Smart alerting với escalation procedures
- **Health Checks**: Comprehensive health check endpoints
- **Performance Monitoring**: Real-time performance tracking

## 🔄 Additional Data Flow Patterns

### 6. User Management Flow

```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   Frontend  │    │   beAuth    │    │ PostgreSQL  │    │   Email     │
│   (React)   │    │   Service   │    │   Database  │    │   Service   │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
       │                   │                   │                   │
       │ 1. Register User  │                   │                   │
       │──────────────────►│                   │                   │
       │                   │                   │                   │
       │                   │ 2. Validate Data  │                   │
       │                   │                   │                   │
       │                   │ 3. Hash Password  │                   │
       │                   │                   │                   │
       │                   │ 4. Store User     │                   │
       │                   │──────────────────►│                   │
       │                   │                   │                   │
       │                   │ 5. Send Welcome   │                   │
       │                   │    Email          │                   │
       │                   │──────────────────────────────────────►│
       │                   │                   │                   │
       │ 6. Success        │                   │                   │
       │    Response       │                   │                   │
       │◄──────────────────│                   │                   │
       │                   │                   │                   │
```

### 7. Report Generation Flow

```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   Frontend  │    │   beCamera  │    │ PostgreSQL  │    │   File      │
│   (React)   │    │   Service   │    │   Database  │    │   Storage   │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
       │                   │                   │                   │
       │ 1. Generate       │                   │                   │
       │    Report         │                   │                   │
       │──────────────────►│                   │                   │
       │                   │                   │                   │
       │                   │ 2. Query Data     │                   │
       │                   │──────────────────►│                   │
       │                   │                   │                   │
       │                   │ 3. Process Data   │                   │
       │                   │                   │                   │
       │                   │ 4. Generate PDF   │                   │
       │                   │                   │                   │
       │                   │ 5. Store File     │                   │
       │                   │──────────────────────────────────────►│
       │                   │                   │                   │
       │ 6. Download URL   │                   │                   │
       │◄──────────────────│                   │                   │
       │                   │                   │                   │
```

### 8. Notification Flow

```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   System    │    │   beCamera  │    │ PostgreSQL  │    │   External  │
│   Event     │    │   Service   │    │   Database  │    │   Services  │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
       │                   │                   │                   │
       │ 1. Event Trigger  │                   │                   │
       │──────────────────►│                   │                   │
       │                   │                   │                   │
       │                   │ 2. Check Rules    │                   │
       │                   │──────────────────►│                   │
       │                   │                   │                   │
       │                   │ 3. Create Alert   │                   │
       │                   │──────────────────►│                   │
       │                   │                   │                   │
       │                   │ 4. Send Notifications│                │
       │                   │──────────────────────────────────────►│
       │                   │                   │                   │
       │                   │ 5. Update Status  │                   │
       │                   │──────────────────►│                   │
       │                   │                   │                   │
```

## 🛠️ Technology Stack Recommendations

### Frontend Stack (Current Implementation)
- **Framework**: React 18.2.0 với JavaScript (không dùng TypeScript)
- **UI Library**: Material-UI (MUI) v5.9.2 + Vision UI Dashboard theme
- **State Management**: React Context API + useReducer (AuthContext)
- **Routing**: React Router DOM v5.2.0
- **HTTP Client**: Native fetch API với custom authAPI service
- **Build Tool**: Create React App (react-scripts v5.0.1)
- **Testing**: Jest + React Testing Library
- **Charts**: ApexCharts v3.30.0 + react-apexcharts
- **Icons**: React Icons v4.3.1 + @mui/icons-material
- **Styling**: Emotion (CSS-in-JS) + custom theme system
- **Form Handling**: Custom implementation với validation
- **Authentication**: JWT tokens với refresh mechanism
- **Real-time**: Chưa implement (cần thêm WebSocket client)

### Backend Stack (Current Implementation)
- **beAuth Service**: Node.js + Express + PostgreSQL (đã implement)
- **beCamera Service**: Python + FastAPI + PostgreSQL (đang phát triển)
- **WebSocket Service**: Chưa implement (cần thêm cho real-time)
- **Message Queue**: Chưa implement (cần thêm cho worker pool)
- **Cache**: Redis (cần thêm cho session và caching)
- **Database**: PostgreSQL với connection pooling (đã setup)
- **Authentication**: JWT tokens với bcryptjs cho password hashing
- **Validation**: Joi cho input validation
- **Logging**: Winston cho structured logging
- **Email**: Nodemailer cho email notifications

### Infrastructure Stack (Current Implementation)
- **Load Balancer**: Chưa implement (cần thêm NGINX)
- **Container**: Docker + Docker Compose (đã setup cho beAuth)
- **Orchestration**: Chưa implement (cần thêm cho production)
- **Monitoring**: Chưa implement (cần thêm Prometheus + Grafana)
- **Logging**: Chưa implement (cần thêm ELK Stack)
- **CI/CD**: Chưa implement (cần thêm GitHub Actions)
- **Environment**: Development setup với hot reload
- **Database**: PostgreSQL với init scripts
- **Port Configuration**: 
  - Frontend: 3000 (React dev server)
  - beAuth: 3001 (Express server)
  - beCamera: 8000 (FastAPI server - planned)

### Security Stack (Current Implementation)
- **Authentication**: JWT tokens với refresh mechanism (đã implement)
- **Password Hashing**: bcryptjs với salt rounds (đã implement)
- **Input Validation**: Joi schema validation (đã implement)
- **CORS**: Express CORS middleware (đã implement)
- **Helmet**: Security headers (đã implement)
- **Rate Limiting**: express-rate-limit (đã implement)
- **Encryption**: Chưa implement TLS/SSL (cần thêm cho production)
- **WAF**: Chưa implement (cần thêm cho production)
- **Secrets Management**: Environment variables (đã setup)
- **Session Management**: JWT-based với localStorage (đã implement)

## 🚧 Implementation Roadmap

### Phase 1: Core Features (Current Status)
✅ **Frontend Foundation**
- React 18.2.0 với Material-UI v5.9.2
- Vision UI Dashboard theme system
- Authentication flow với JWT tokens
- Protected routes và context management
- Basic dashboard layout và navigation

✅ **Backend Foundation (beAuth)**
- Node.js + Express server
- PostgreSQL database với user management
- JWT authentication với refresh tokens
- Input validation với Joi
- Security middleware (CORS, Helmet, Rate limiting)

### Phase 2: Camera Management (Next Priority)
🔄 **Frontend Components**
- Camera management interface
- Real-time camera status display
- Camera configuration forms
- Live video stream viewer

🔄 **Backend Services (beCamera)**
- Python + FastAPI server
- Camera CRUD operations
- Stream management và validation
- Basic AI model integration

### Phase 3: Real-time Processing (High Priority)
⏳ **WebSocket Integration**
- Socket.io server cho real-time communication
- WebSocket client trong React app
- Real-time data streaming
- Connection management và reconnection logic

⏳ **Worker Pool Architecture**
- Python worker pool cho camera processing
- Message queue (Redis/RabbitMQ) cho task distribution
- Load balancing và failover mechanisms
- Performance monitoring

### Phase 4: Analytics & Reporting (Medium Priority)
⏳ **Analytics Engine**
- Data aggregation services
- Report generation (PDF/Excel)
- Chart và visualization components
- Export functionality

⏳ **Advanced Features**
- Email notifications
- Alert system
- User activity tracking
- Advanced filtering và search

### Phase 5: Production Infrastructure (High Priority)
⏳ **Infrastructure Setup**
- Docker containerization cho tất cả services
- NGINX load balancer
- Redis cache layer
- Monitoring và logging stack

⏳ **Security & Performance**
- SSL/TLS encryption
- Advanced security measures
- Performance optimization
- Scalability improvements

## 📋 Summary & Best Practices

### Key Takeaways
1. **Current Foundation**: Solid foundation với React + Material-UI frontend và Node.js authentication backend
2. **Microservices Architecture**: Tách biệt rõ ràng giữa authentication (beAuth) và camera processing (beCamera)
3. **Authentication System**: Complete JWT-based authentication với refresh tokens và protected routes
4. **Security Implementation**: Basic security measures đã implement (CORS, Helmet, Rate limiting, Input validation)
5. **Development Ready**: Hot reload development environment với Docker setup cho backend
6. **Next Steps**: Focus vào camera management, real-time processing, và production infrastructure

### Implementation Priority (Updated)
1. **Phase 1**: ✅ Core authentication và basic dashboard (COMPLETED)
2. **Phase 2**: 🔄 Camera management interface và backend services (IN PROGRESS)
3. **Phase 3**: ⏳ Real-time processing và WebSocket integration (NEXT)
4. **Phase 4**: ⏳ Analytics và reporting capabilities (PLANNED)
5. **Phase 5**: ⏳ Production infrastructure và advanced features (PLANNED)

### Common Pitfalls to Avoid
- **Over-engineering**: Start simple và scale gradually
- **Security Neglect**: Implement security từ đầu, không phải sau này
- **Poor Error Handling**: Comprehensive error handling cho tất cả edge cases
- **Inadequate Monitoring**: Implement monitoring trước khi deploy production
- **Database Bottlenecks**: Proper indexing và query optimization từ đầu

### Success Metrics
- **Performance**: < 500ms latency cho real-time data
- **Reliability**: 99.9% uptime với automatic failover
- **Scalability**: Support 100+ concurrent camera streams
- **Security**: Zero security incidents và compliance adherence
- **User Experience**: Sub-2s page load times và smooth real-time updates

---

**Tài liệu này cung cấp framework toàn diện cho Data Flow System, đảm bảo production readiness với focus vào reliability, security, performance và scalability. Tất cả các luồng data flow từ frontend đến backend đã được mô tả chi tiết với các patterns thực tế trong production environment.**

**Lưu ý**: Tài liệu này nên được cập nhật định kỳ khi có thay đổi trong architecture hoặc requirements. Đảm bảo team development review và approve tất cả thay đổi trước khi implement. 